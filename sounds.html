<!-- also stored at codepen -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<html>
  <head>
<script>
  // Place this before all other script:
  // This will catch syntax errors when loading
  //window.onerror = (...args)=>{
  window.addEventListener('error', (...args)=>{
    alert(''+args[0].type);
    // how to debug your debugger!
    try {
      insertError('afterbegin', args);
      return true; // ?
    } catch(e) {
      alert('window.onerror: \n'+e);
    }
  }, true);

  function insertError(where, args, style) {
    // add script id info if have
    let csid = document.currentScript &&
	document.currentScript.id;
    let script = document.scripts[document.scripts.length-1];
    let lsid = script && script.id;
    if (csid) args.unshift(`script.id=${csid} (current)`);
    if (lsid != csid) args.unshift(`script.id=${csid} (last)`);

    // stack?
    // https://v8.dev/docs/stack-trace-api
    let stack = event.stack;
    if (stack) {
      args.push(`Stack: ${stack}`);
    }
    args.push(`Event: ${event}`);

    // insert
    if (!style) style = 'color:red;';
    // no use: this ${typeof this}: ${this}\n

    let t = `<pre style='${style}'>
${args.map((x,i)=>`${i} ${typeof x}: ${x}\n`).join('')}
</pre>`;
    //document.body.insertAdjacentHTML(where, t);
    if (document.body)
      document.body.insertAdjacentHTML(where, t);
    else 
      document.write(t);
  }
</script>


<!-- The MEAT of the project -->
<script src='sounds.js')>
</script>
<!-- End MEAT -->

</head>

<body style='zoom:1.3;'>

<center>
  <div>
    <button onclick='sounds(3);'>init</button>
    <button onclick='sounds.mute();'>mute</button>
    <button onclick='sounds.volume(channel, -1)'>-1</button>
    <button onclick='sounds.volume(channel, 0)'>0</button>
    <button onclick='sounds.volume(channel, 0.1)'>0.1</button>
    <button onclick='sounds.volume(channel, 0.2)'>0.2</button>
    <button onclick='sounds.volume(channel, 0.5)'>0.5</button>
    <button onclick='sounds.volume(channel, 1)'>1</button>
  </div><br><div>
    <button id=c0 onclick='ch(0);'>0</button>
    <button id=c1 onclick='ch(1);'>1</button>
    <button id=c2 onclick='ch(2);'>2</button>
  </div><br><div>
    <button onclick='env("sine")'>sine</button>
    <button onclick='env("square")'>square</button>
    <button onclick='env("triangle")'>triangle</button>
    <button onclick='env("saw")'>saw</button>
  </div><br><div>
    <button onclick='freq(261.6)'>C4</button>
    <button onclick='freq(261.6*2)'>C5</button>
    <button onclick='freq(261.6*4)'>C6</button>
    <button onclick='freq(220)'>A3</button>
    <button onclick='freq(440)'>A4</button>
    <button onclick='freq(880)'>A5</button>
    <button onclick='freq(1760)'>A6</button>
    <button onclick='freq(830.6)'>G#5</button>
  </div><br><div>
    <button onclick='stop()'>stop</button>
    <button onclick='stop(0.1)'>stop 0.1</button>
    <button onclick='stop(1)'>stop 1</button>
    <button onclick='stop(5)'>stop 5</button>
    <button onclick='stop(10)'>stop 10</button>
  </div><br><div>
    <button onclick='handping()'>handping</button>
    <button onclick='mysound()'>mysound</button>

  </div>

  <br><div>
    VolMul<br>
    <input id=vmul size=5 value='0.3'><br>
  </div>
</center>
<br>
<div>
  Sequencer
  <button onclick='sounds(seq.value)'>run</button> (or CTRL-ENTER)<br>
  <textarea id=seq size=60 style='font-weight:bold; font-size:2rem;'>1f2612qv1~4v0
2f3v1~6v0</textarea>
</div>
  
<script>
  seq.onkeypress = function(k) {
    if (k.ctrlKey && k.keyCode == 13) {
      try {
	sounds(seq.value);
      } catch(e) { alert('SEQ:' + e); }
    }
  }
</script>

</body>

<script>
  // Place this as last script (after body):
  // This will catch runtime errors
//  window.onerror = (...args)=>{

  window.addEventListener('error', (...args)=>{
    //alert(args[0].message);
    // how to debug your debugger!
    try {
      insertError('beforeend', args);
      return true; // ?
    } catch(e) {
      alert('window.onerror: \n'+ee);
    }
  }, true);
</script>

</html>
